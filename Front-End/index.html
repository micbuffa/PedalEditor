<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-store" />

    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <script src="./bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <script src="./bower_components/webaudio-controls/webaudio-controls.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script
        src="https://wasabi.i3s.unice.fr/WebAudioPluginBank/bower_components/webaudio-controls2/webaudio-controls.js">
    </script>
    <script src="https://wasabi.i3s.unice.fr/WebAudioPluginBank/sdk/WebAudioSDK.js"></script>

    <link rel="stylesheet" href="StyleSheet.css">
    <link rel="stylesheet" href="StyleSideNav.css">
    <link rel="stylesheet" href="index_css.css">
    <link rel="Stylesheet" href="SideBar.css">
    <link rel="Stylesheet" href="police_select.css">

    <link type="text/css" rel="stylesheet" href="rgbaColorPicker/rgbaColorPicker.css" />
    <script type="text/javascript" src="rgbaColorPicker/rgbaColorPicker.js"></script>

    <link rel="import" href="pedal_models/pedal.html">
    <link rel="import" href="editor-components/editor-pedal-details/editor-pedal-details.html">
    <link rel="import" href="editor-components/editor-element-list.html">
    <link rel="import" href="editor-components/editor-inspector.html">
    <link rel="import" href="editor-components/editor-faust/editor-faust.html">
    <link rel="import" href="editor-components/editor-pedal-new/editor-pedal-new-1.html">

    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->


    <link href='https://fonts.googleapis.com/css?family=Montez|Lobster|Roboto|Lexend+Zetta|Josefin+Sans|Shadows+Into+Light|Pacifico|Amatic+SC:700|Orbitron:400,900|Rokkitt|Righteous|Dancing+Script:700|Bangers|Chewy|Sigmar+One|Architects+Daughter|Abril+Fatface|Covered+By+Your+Grace|Kaushan+Script|Gloria+Hallelujah|Satisfy|Lobster+Two:700|Comfortaa:700|Cinzel|Courgette' rel='stylesheet' type='text/css'>


    <!-- jQuery library -->

    <!-- Latest compiled JavaScript -->
    <!--<link rel="import" href="blue.html">
    <script src="jscolor.js"></script>-->

    <script src="pedal_models/functionalPedalGenerator.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.0/TweenMax.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/plugins/TextPlugin.min.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <!-- <script src="editor_components/editor-inspector.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

    <script src="jscolor.js"></script>

    <link
        href="https://fonts.googleapis.com/css?family=Abril+Fatface|Belgrano|Bevan|Bungee+Inline|Bungee+Shade|Calligraffitti|Mogra|Nothing+You+Could+Do|Orbitron|Pangolin|Rock+Salt|Sansita|Shojumaru|UnifrakturMaguntia|VT323"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <title>Pedal Creator 0.1</title>
    <style>

        h2, h3 {margin: 0 0 6px;
                font-size: 150%;
                font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;}
        #box {
            width: 40%;
            float: left;
            padding: 16px;
            margin: 25px
        }
    
        .boxshadow {
            border-radius: 8px border: 1px solid #fff;
            background: #ddd;
        }
    
        a.button {
            cursor: pointer
        }
    
        .row0,
        .row1 {
            padding: 3px
        }
    
        .row1 {
            background: #222
        }
    
        .minus,
        .plus {
            background: silver;
            background-image: linear-gradient(to bottom, #eee 0%, #ddd 50%, #bbb 50%, #ddd 100%);
            color: #111;
            font-weight: bold;
            padding: 2px 3px;
            display: inline-block;
            width: 15px;
            cursor: pointer;
            text-align: center;
            border-radius: 2px
        }
    
        #settings {
            float: right;
            width: 170px;
            background: #EEE;
            padding: 5px;
            border: 1px solid white;
            box-shadow: 0px 0px 5px #888;
            font-size: 85%;
            line-height: 1.1em
        }
    
        #settings input {
            margin: 0;
            line-height: 1.1em
        }
    
        #settings h4 {
            font-weight: bold;
            margin-bottom: 3px
        }
    
        .codebox {
            padding: 15px;
            background: #ffc;
            border: 1px dotted #ccc;
        }
    
        #snippet {
            font-style: italic
        }
    
        .swatch {
            width: 30px;
            height: 30px;
            display: inline-block;
            background: #e2001a;
            margin-right: 20px;
            cursor: pointer
        }
    
        hr.dotted {
            clear: both;
            display: block;
            height: 0;
            border-bottom: 1px dotted #ccc
        }
    
        .params {
            width: 20%;
            margin: 25px 10px 0;
            border-radius: 12px;
            border: 8px solid #04d3ff;
            background-color: #111;
            padding: 8px;
            float: right;
            color: #999;
            font-size: 80%;
        }
    
    
    
        .center {
            text-align: center;
        }
    
        .menu {
            width: 200px;
            z-index: 1;
            box-shadow: 0 4px 5px 3px rgba(0, 0, 0, 0.2);
            position: fixed;
            display: none;
            transition: 0.2s display ease-in;
    
            .menu-options {
                list-style: none;
                padding: 10px 0;
                z-index: 1;
    
                .menu-option {
                    font-weight: 500;
                    z-index: 1;
                    font-size: 14px;
                    padding: 10px 40px 10px 20px;
                    border-bottom: 1.5px solid rgba(0, 0, 0, 0.2);
                    cursor: pointer;
    
                    &:hover {
                        background: rgba(0, 0, 0, 0.2);
                    }
                }
            }
        }
    
    
    
        button {
            background: grey;
            border: none;
    
            .next {
                color: green;
            }
    
            &[disabled="false"]:hover {
                .next {
                    color: red;
                    animation: move 0.5s;
                    animation-iteration-count: 2;
                }
            }
        }
    
        @keyframes move {
            from {
                transform: translate(0%);
            }
    
            50% {
                transform: translate(-40%);
            }
    
            to {
                transform: transform(0%);
            }
        }
    </style>
</head>

<body>
        

    <!-- Pedal section -->
    <main class="pedalSection"></main>
    <div class="container"></div>

    <nav class="navbar navbar-expand navbar-dark bg-dark"> <a href="#menu-toggle" id="menu-toggle" class="navbar-brand"><span class="navbar-toggler-icon"></span></a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample02" aria-controls="navbarsExample02" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
        <div class="collapse navbar-collapse" id="navbarsExample02">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"> <a class="nav-link" href="#" id="removeLink" onclick="removeDOMElement()"><i class="fa fa-trash"></i></a> </li>
                <li class="nav-item active"> <a class="nav-link" href="#" onclick="toggleFullScreen()"><i class="fa fa-arrows-alt"></i></a> </li>
                <li class="nav-item active"> <a class="nav-link" href="#"><i class="fa fa-download"></i></a> </li>
                <li class="nav-item active"> <a class="nav-link" href="#" onclick="savePedal()"><i class="fa fa-save"></i></a> </li>
                <li class="nav-item active"> <a class="nav-link" href="#" onclick="window.open('faust-editor','popUpWindow','height=500,width=400,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no, status=yes');"><i class="fa fa-pencil"></i></a> </li>
                <li class="nav-item active"> <a class="nav-link" data-toggle="modal" data-target="#myModal" href="#myModal"><i class="fa fa-plus-circle"></i></a></li>
                <li class="nav-item active"> <a class="nav-link" href="#" onclick="window.location.reload();"><i class="fa fa-home"></i> <span class="sr-only">(current)</span></a> </li>
            </ul>
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"> <a class="nav-link" href="#"></a> </li>
                <li class="nav-item active"> <a class="nav-link" href="#"></a> </li>
            </ul>
            <form class="form-inline my-2 my-md-0"> </form>
        </div>
    </nav>


    <div class="area"></div><nav class="main-menu">
        <ul style="direction: ltr;">
            
            <li>
                <a  href="#" onclick="drawRectangle()">
                    <i class="fa fa-pencil fa-2x"></i>
                    <span class="nav-text">
                       Draw
                    </span>
                </a>
            
            </li>
            
            <li class="has-subnav">
                <a data-toggle="modal" data-target="#myModal3" href="#myModal">
                    <i class="fa fa-mouse-pointer fa-2x"></i>
                    <span class="nav-text">
                       Items Positioning
                    </span>
                </a>
            
            </li>

            <li class="has-subnav">
                <a data-toggle="modal" data-target="#myModal4" href="#myModal">
                    <i class="fa fa-truck fa-2x"></i>
                    <span class="nav-text">
                        Pedal Templates
                    </span>
                </a>
            </li>

            <li class="has-subnav">
                <a data-toggle="modal" data-target="#myModal5" href="#myModal">
                    <i class="fa fa-cog fa-2x"></i>
                    <span class="nav-text">
                        Pedal Parameters
                    </span>
                </a>
            </li>

            <li class="has-subnav">
                <a href="#" onclick="toggleLabelMenu()" id="LabelMenu">
                    <i class="fa fa-font fa-2x"></i>
                    <span class="nav-text">
                        Label Parameters
                    </span>
                </a>
            </li>

            <li class="has-subnav">
                    <a href="#" onclick="togglePreSetsFunction()" id="PresetsMenu">
                        <i class="fa fa-toggle-on fa-2x"></i>
                        <span class="nav-text">
                            Toggle Presets
                        </span>
                    </a>
            </li>

            <li class="has-subnav">
                    <a href="#" onclick="toggleShadowMenuFunction()" id="ShadowMenu">
                        <i class="fa fa-tasks fa-2x"></i>
                        <span class="nav-text">
                            Toggle Shadow Menu
                        </span>
                    </a>
            </li>
        </ul>

        
    </nav>

    
    <div class="menu" id="menu">
            <a href="#" id="closeLink" onclick="closeMenu()"><i class="fas fa-times fa-2x" style="float: right; color: red; position: absolute; top: -15px;
                right: -10px;"></i></a>
        <ul class="menu-options">
          <li class="menu-option" style="list-style-type: none;">
            <div style="display: inline-block; direction: ltr;">
                <select id='select' onChange="changeLabelFont(this);" style="direction: ltr; width: 80px; position: relative;">
                </select>
                <select id="sel1" onchange="changeSize(this);" style="direction: ltr; width: 35px; position: relative;">
                    <option>4</option>
                    <option>8</option>
                    <option>12</option>
                    <option>16</option>
                    <option>20</option>
                    <option>24</option>
                    <option>28</option>
                    <option>32</option>
                    <option>36</option>
                    <option>40</option>
                    <option>44</option>
                    <option>48</option>
                    <option>52</option>
                    <option>56</option>
                    <option>58</option>
                </select>
                <a href="#" onclick="fontSizeX()" id="fontSizeX"><i class="fas fa-plus" style="color: black;"></i></a>
                <a href="#" onclick="fontSizeY()" id="fontSizeY"><i class="fas fa-minus" style="color: black;"></i></a>
            </div>
            
            <div style="display: inline-block; direction: ltr;">
                <a href="#" id="boldid" onclick="BoldStyle()"><i class="fa fa-bold" style="color: black; float: left; width: 20px;"></i></a>
                <a href="#" id="underlineid" onclick="UnderlineStyle()"><i
                    class="fa fa-underline" style="color: black; float: left; width: 20px;"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="#" id="griplinesid" onclick="GripLinesStyle()"><i class="fas fa-grip-lines" style="color: black; float: left; width: 20px;"></i></a>
            </div>
            <div style="display: inline-block; direction: ltr;">
                <input type="submit" class="jscolor" style="direction: ltr; width: 80px;" id="jscolorpick" onchange="changeColor(this);">
            </div>
            <br>
            <br>
            <div style="display: inline-block; direction: ltr;">
                <a href="#" type="submit" class="btn btn-default" onclick="moveLabelXLeft()" id="moveLabelXLeft">&larr;</a>
                <a href="#" type="submit" class="btn btn-default" onclick="moveLabelYDown()" id="moveLabelYDown">&darr;</a>
                <a href="#" type="submit" class="btn btn-default" onclick="moveLabelXRight()" id="moveLabelXRight">&rarr;</a>
                <a href="#" type="submit" class="btn btn-default" onclick="moveLabelYUp()" id="moveLabelYUp">&uarr;</a>
            </div>
          </li>
        </ul>
    </div>


      



    <div id="myModal5" class="modal fade" role="dialog">
        <div class="modal-dialog" style="background-color: #333;">
      
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="background-color: #333;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" style="color: blanchedalmond;">Pedal Parameters</h4>
        </div>
        <div class="modal-body" style="background-color: #333;">
            <div class="form-group">
                <label class="col-sm-2 control-label" for="textinput" style="color: white;">Name</label>
                <div class="col-sm-10">
                  <input type="text" placeholder="Input Name" id="nompedal" class="form-control">
                </div>
            </div>

            <div class="form-group" style="direction: ltr; float: right;">
                <button type="submit" class="btn btn-primary" onclick="submitChange()" id="submitlink">Submit</button>
            </div>
        </div>

        </div>
       <!--  <div class="modal-footer" style="background-color: #333;" style="direction: ltr; float: right;">
            <button type="submit" class="btn btn-primary" onclick="submitChange()" id="submitlink">Submit</button>
        </div> -->
      </div>
      
        </div>
      </div>
      
      

    <div id="myModal4" class="modal fade" role="dialog">
        <div class="modal-dialog" style="background-color: #333;">
      
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="background-color: #333;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" style="color: blanchedalmond;">Pedal Templates</h4>
        </div>
        <div class="modal-body" style="background-color: #333;">
          <!-- <editor-pedal-new-1 width="400" height="400"></editor-pedal-new-1> -->
          

            <div class="container" style="direction: ltr;">
                <iframe src="pedal_templates/distorder/testDistorder.html" width="285" height="320" id="template1"></iframe>
            </div>
            <a href="#selectTemplate" onclick="LoadTemplateConfig()" id="selectTemplate">Select Template</a>

        
        </div>

        </div>
        <div class="modal-footer" style="background-color: #333;">
            <!-- <button class="mainbtn" onclick="deleteSelectedElement()">Delete</button> -->
            <!-- <div class="form-group">
                <a class="btn btn-primary" onclick="removeDOMElement()">Delete</a>
            </div> -->
        </div>
      </div>
      
        </div>
      </div>

      

    <div id="myModal3" class="modal fade" role="dialog">
        <div class="modal-dialog" style="background-color: #333;">
      
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="background-color: #333;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" style="color: blanchedalmond;">Draw Menu</h4>
        </div>
        <div class="modal-body" style="background-color: #333;">
          <!-- <editor-pedal-new-1 width="400" height="400"></editor-pedal-new-1> -->
          

            <div class="editor-collapsible-content" >
                    <editor-inspector id="editor-inspector" ></editor-inspector>
            </div>
          

        
        </div>

        </div>
        <div class="modal-footer" style="background-color: #333;">
            <!-- <button class="mainbtn" onclick="deleteSelectedElement()">Delete</button> -->
            <!-- <div class="form-group">
                <a class="btn btn-primary" onclick="removeDOMElement()">Delete</a>
            </div> -->
        </div>
      </div>
      
        </div>
      </div>




    <div id="myModal2" class="modal fade" role="dialog">
        <div class="modal-dialog" style="background-color: #333;">
      
      <!-- Modal content-->
    <div class="modal-content">
        <div class="modal-header" style="background-color: #333;">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title" style="color: blanchedalmond;">Draw Menu</h4>
        </div>
        <div class="modal-body" style="background-color: #333;">
            <!-- <editor-pedal-new-1 width="400" height="400"></editor-pedal-new-1> -->
            <div class="form-group">
                <label class="col-sm-2 control-label" for="select" style="color: white;"></label>&nbsp;&nbsp;&nbsp;
                <div class="col-sm-9">
                    
                </div>
            </div>
    
            <div class="form-group">
                <div class="col-sm-9" style="direction: ltr;">
                    
                </div>
            </div>
    
    
            <div class="form-group">
                <div class="col-sm-9" style="direction: ltr;">
                    
                </div>
            </div>

        </div>

        

        <div class="modal-footer" style="background-color: #333;">
                <div id = "text">
                        <p id = "h3"  style="color: white; direction: ltr; visibility: hidden;">
                            
                        </p>
                </div>
        </div>
      </div>
      
        </div>
      </div>





    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog" style="background-color: #333;">
      
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="background-color: #333;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" style="color: blanchedalmond;">New Pedal</h4>
        </div>
        <div class="modal-body" style="background-color: #333;">
          <!-- <editor-pedal-new-1 width="400" height="400"></editor-pedal-new-1> -->
          <div class="form-group">
            <label class="col-sm-2 control-label" for="textinput" style="color: white;">Width</label>
            <div class="col-sm-10">
              <input type="text" placeholder="Input Width" id="width" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-2 control-label" for="textinput" style="color: white;">Color</label>
            <div class="col-sm-10">
              <input type="text" style="width: 100%;" placeholder="Select Color" id="color" class="color" >
            </div>
          </div>
          <br>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="textinput" style="color: white;">Height</label>
            <div class="col-sm-10">
              <input type="text" placeholder="Input Height" id="height" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-2 control-label" for="textinput" style="color: white;">Radius</label>
            <div class="col-sm-10">
              <input type="text" placeholder="Input Radius" id="radius" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-2 control-label" for="textinput" style="color: white;">Name</label>
            <div class="col-sm-10">
              <input type="text" placeholder="Input Name" id="name" name="name" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label class="col-sm-2 control-label" for="textinput" style="color: white;">Label</label>
            <div class="col-sm-10">
              <input type="text" placeholder="Input Label" id="label" class="form-control">
            </div>
          </div>

        </div>
        <div class="modal-footer" style="background-color: #333;">
            <div class="form-group">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <div class="pull-right">
                    <button type="submit" class="btn btn-default" style="color: black; background-color: white;" onclick="refreshModal()">Refresh</button>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button type="submit" class="btn btn-primary" onclick="newPedal()">Create</button>
                </div>
            </div>
        </div>
      </div>
      
        </div>
      </div>

    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <div id="accordion">
                    <div style="direction: ltr;">
                            <details class="editor-collapsible">
        
                                    <summary style="color: #999;"><a href="#editor-pedal-details">Pedal configuration</a></summary>
                        
                                    <div class="editor-collapsible-content">
                                            <editor-pedal-details id="editor-pedal-details" class="accordion" style="background-color: #333;"></editor-pedal-details>
                                    </div>
                            </details>   

                            <details class="editor-collapsible">
        
                                    <summary style="color: #999;">Elements </summary>
                        
                                    <div class="editor-collapsible-content" >
                                            <editor-element-list id="editor-element-list" class="accordion"></editor-element-list>
                                    </div>
                            </details>
                            
                            <!-- <details class="editor-collapsible">
        
                                    <summary><a href="#editor-inspector">Inspector </a></summary>
                        
                                    <div class="editor-collapsible-content" >
                                            <editor-inspector id="editor-inspector" class="accordion"></editor-inspector>
                                    </div>
                            </details> -->

                            <details class="editor-collapsible">
        
                                    <summary style="color: #999;">Faust</summary>
                        
                                    <div class="editor-collapsible-content" >
                                            <editor-faust id="editor-faust" class="accordion"></editor-faust>
                                    </div>
                            </details>
                    </div>
                    
                </div>
            </div>
                    
            </ul>
        </div> 

        <!-- /#sidebar-wrapper -->
        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                
            </div>
        </div> <!-- /#page-content-wrapper -->
    </div>

    <div style="background: white; display: none; direction: ltr;" class="params draggables" id="presetsid">
        <h3>pre sets</h3>
        <div style="box-shadow: 5px 5px #333" class="swatch"></div>hard light
        <hr class="dotted">
        <div style="box-shadow: 5px 5px 3px #666" class="swatch"></div> soft
        <hr class="dotted">
        <div style="box-shadow: 0px 0px 5px #444" class="swatch"></div> from above
        <hr class="dotted">
        <div style="box-shadow: 0px 8px 6px -6px #666" class="swatch"></div> reduced
        <hr class="dotted">
        <div style="box-shadow: inset 0px 0px 10px #666" class="swatch"></div> inset
        <hr class="dotted">
        <div style="box-shadow: 0px 0px 10px -2px #FFF" class="swatch"></div> glow
    </div>
    
    <div class="params draggables" id="shadowmenuid" style="display: none; direction: ltr;">
        <h3>box-shadow parameters</h3>
    
        <div class="row0">
            <div class="minus">-</div>
            <input value="3" size="3" id="offX">
            <div class="plus">+</div>
            <label>Offset X</label>
        </div>
    
        <div class="row1">
            <div class="minus">-</div>
            <input value="3" size="3" id="offY">
            <div class="plus">+</div>
            <label>Offset Y</label>
        </div>
    
        <div class="row0">
            <div class="minus">-</div>
            <input value="3" size="3" id="blur">
            <div class="plus">+</div>
            <label>Blur</label>
        </div>
    
        <div class="row1">
            <div class="minus">-</div>
            <input value="3" size="3" id="spread">
            <div class="plus">+</div>
            <label>Spread</label>
        </div>
    
        <div class="row0">
            &nbsp; #<input value="555555" size="6" id="color"> <label>Color (HEX)</label>
        </div>
    
        <div class="row1">
            <input type="checkbox" value="inset" id="inset"><label>inset</label>
        </div>
    
        <br />
        <button id="surprise" class="button">Surprise Me!</button>
    </div>
    <hr style="clear: both; display:block; visibility: hidden; height: 30px" />
</body>
<script>



$('div.params input').blur(function(){
  setShadow();
})

$('#inset').click(function(){
   setShadow();
})

$('div.minus').click(function(){
     var toChange = $(this).next();
     toChange.val( parseInt(toChange.val()) -1 );
     setShadow();
})

 $('div.plus').click(function(){
     var toChange = $(this).prev();
     toChange.val( parseInt(toChange.val()) +1 );
     setShadow();
})

$('#surprise').click(function(){
   setRandom();
   setShadow();
})        

$('#variants').click(function(){
   for (var c=0; c < 5; c++) {
       // boxshadow     offsetX           offsety              blur                             spread
       var shdw2 = rndnr('15') + 'px ' + rndnr('15') + 'px ' + Math.abs(rndnr('30')) + 'px ' + rndnr('10') + 'px ' + '#' + $('#color').val();           
       var html = "<div class='box' style='box-shadow: "+shdw2+"'>"+shdw2+"</div>";
       $('div.entry-content').append(html);
   }
})     


$('div.swatch').click(function(){
    $('#box').attr('style', $(this).attr('style'));
    $('#snippet').html($(this).attr('style'));
})


function setShadow () {
    var b = document.getElementById('my-pedal'); var shdw = '';
    if(b.shadowRoot){
        if (document.getElementById('inset').checked) {
        shdw += 'inset ';
      }           
        shdw += document.getElementById('offX').value +'px ' + document.getElementById('offY').value + 'px '+ document.getElementById('blur').value + 'px ' + document.getElementById('spread').value + 'px #' + document.getElementById('color').value;
      
        pedal.shadowRoot.getElementById('pedal').style.boxShadow = shdw;
        //$('#snippet').html('box-shadow: '+shdw);
    }
    
}


function setRandom() {
    document.getElementById('offX').value = rndnr('15');
    document.getElementById('offY').value = rndnr('15');
    document.getElementById('blur').value = Math.abs(rndnr('30'));
    document.getElementById('spread').value = rndnr('10');
    
    // inset
    var rndInset = Math.random();
    if (rndInset < .6) { document.getElementById('inset').checked = false; } else { document.getElementById('inset').checked = true; } ;
}

function rndnr(range) {
    var randomNum = Math.ceil(Math.random()* range)
    var vz = Math.random();
    if (vz < .5) randomNum = -1 * randomNum;          
    return randomNum;
}

setShadow();







// target elements with the "draggable" class
interact('.draggables')
  .draggable({
    onmove: window.dragMoveListener,
  })
  .resizable({
    // resize from all edges and corners
    edges: { left: true, right: true, bottom: true, top: true },

    modifiers: [
      // keep the edges inside the parent
      interact.modifiers.restrictEdges({
        outer: 'parent',
        endOnly: true
      }),

      // minimum size
      interact.modifiers.restrictSize({
        min: { width: 100, height: 50 }
      })
    ],

    inertia: true
  })
  .on('resizemove', function (event) {
    var target = event.target
    var x = (parseFloat(target.getAttribute('data-x')) || 0)
    var y = (parseFloat(target.getAttribute('data-y')) || 0)

    // update the element's style
    target.style.width = event.rect.width + 'px'
    target.style.height = event.rect.height + 'px'
    //pedal.shadowRoot.getElementById('background-image').style.width = target.style.width
    //pedal.shadowRoot.getElementById('background-image').style.height = target.style.height

    // translate when resizing from top or left edges
    x += event.deltaRect.left
    y += event.deltaRect.top

    target.style.webkitTransform = target.style.transform =
        'translate(' + x + 'px,' + y + 'px)'

    target.setAttribute('data-x', x)
    target.setAttribute('data-y', y)
    //target.textContent = Math.round(event.rect.width) + '\u00D7' + Math.round(event.rect.height)
  })

function dragMoveListener (event) {
  var target = event.target
  // keep the dragged position in the data-x/data-y attributes
  var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx
  var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy

  // translate the element
  target.style.webkitTransform =
    target.style.transform =
      'translate(' + x + 'px, ' + y + 'px)'

  // update the posiion attributes
  target.setAttribute('data-x', x)
  target.setAttribute('data-y', y)
}

// this is used later in the resizing and gesture demos
//window.dragMoveListener = dragMoveListener;


function toggleShadowMenuFunction(){
  var x = document.getElementById("shadowmenuid");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}


function togglePreSetsFunction() {
  var x = document.getElementById("presetsid");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}



function toggleLabelMenu(){
    var linkId = document.getElementById('LabelMenu');
    var click = 0;
    var pp = document.querySelector('my-pedal');

    linkId.onclick = function(){
        click ++;
        if(pp.shadowRoot){
            window.addEventListener("contextmenu", e => {
                if((click % 2)==0){
                    this.removeEventListener("contextmenu",e,false);
                    console.log("number of clicks is:"+click);
                }
                else{
                    e.preventDefault();
                    const origin = {
                        left: e.pageX + 10,
                        top: e.pageY + 10
                    };
                    setPosition(origin);
                    console.log("number of clicks is :"+click);
                    return false;
                }}); 
        }
    };
}



function drawRectangle(){
    var pp = document.querySelector('my-pedal');
    if(pp.shadowRoot){
        initDraw(pedal.shadowRoot.getElementById('pedal'));
    }
    
}

function initDraw(canvas) {
    function setMousePosition(e) {
        var ev = e || window.event; //Moz || IE
        if (ev.pageX) { //Moz
            mouse.x = ev.pageX + window.pageXOffset;
            mouse.y = ev.pageY + window.pageYOffset;
        } else if (ev.clientX) { //IE
            mouse.x = ev.clientX + document.body.scrollLeft;
            mouse.y = ev.clientY + document.body.scrollTop;
        }
    };

    var mouse = {
        x: 0,
        y: 0,
        startX: 0,
        startY: 0
    };
    var element = null;

    canvas.onmousemove = function (e) {
        setMousePosition(e);
        if (element !== null) {
            element.style.width = Math.abs(mouse.x - mouse.startX) + 'px';
            element.style.height = Math.abs(mouse.y - mouse.startY) + 'px';
            element.style.left = (mouse.x - mouse.startX < 0) ? mouse.x + 'px' : mouse.startX + 'px';
            element.style.top = (mouse.y - mouse.startY < 0) ? mouse.y + 'px' : mouse.startY + 'px';
        }
    }

    canvas.onclick = function (e) {
        if (element !== null) {
            element = null;
            canvas.style.cursor = "default";
            console.log("finsihed.");
        } else {
            console.log("begun.");
            mouse.startX = mouse.x;
            mouse.startY = mouse.y;
            element = document.createElement('div');
            element.className = 'rectangle'
            element.style.left = mouse.x + 'px';
            element.style.top = mouse.y + 'px';
            canvas.appendChild(element)
            canvas.style.cursor = "crosshair";
        }
    }
}




window.onmousemove = moveElem;
window.onmouseup = stopMovingElem;


var selected = null; // element to be moved
var oldMouseX, oldMouseY; // Stores x & y coordinates of the mouse pointer
var elemX, elemY;
var divs = [];

  
// Will be called when user starts dragging an element
function dragInit(evt) {
    // Store the elem
    selected = evt.target;
    elemX = selected.offsetLeft;
    elemY = selected.offsetTop;
  
    oldMouseX = evt.clientX;
    oldMouseY = evt.clientY;
    //evt.stopPropagation();
}

// Will be called when user dragging an element
function moveElem(e) {
    // new mouse ps
    var newMouseX = e.clientX;
    var newMouseY = e.clientY;
  
    if(oldMouseX !== undefined) {
        // how many pixels did we move the mouse?
        var dx = newMouseX - oldMouseX;
        var dy = newMouseY - oldMouseY;
     }
    
    if (selected !== null) {  
        // move the selected element dx, dy pixels hozontally/vertically
        changePosOfSelectedElement(dx, dy);
    }
  
    // update the old position of the mouse
    oldMouseX = newMouseX;
    oldMouseY = newMouseY;
}

function changePosOfSelectedElement(dx, dy) {
  // update the old position of the selected element
  elemX += dx;
  elemY += dy;
  
  // change the pos on screen of the element
  // by modifying its CSS left/top properties
  selected.style.left = elemX + 'px';
  selected.style.top = elemY + 'px';
}

// Destroy the object when we are done
function stopMovingElem() {
    selected = null;
}

function submitChange(){
    pedal.name = document.getElementById('nompedal').value;
}

const menu = document.querySelector(".menu");
    let menuVisible = false;

    const toggleMenu = command => {
        menu.style.display = command === "show" ? "block" : "none";
        menuVisible = !menuVisible;
    };

    const setPosition = ({ top, left }) => {
        menu.style.left = `${left}px`;
        menu.style.top = `${top}px`;
        toggleMenu("show");
    };

    /* if (document.querySelector('my-pedal').shadowRoot) {
        window.addEventListener("click", e => {
            if (menuVisible) toggleMenu("hide");
        });

        window.addEventListener("contextmenu", e => {
            e.preventDefault();
            const origin = {
                left: e.pageX,
                top: e.pageY
            };
            setPosition(origin);
            return false;
        });
    } */

var fonts = ["Montez","Lobster","Roboto","Lexend Zetta","Josefin Sans","Shadows Into Light","Pacifico","Amatic SC", "Orbitron", "Rokkitt","Righteous","Dancing Script","Bangers","Chewy","Sigmar One","Architects Daughter","Abril Fatface","Covered By Your Grace","Kaushan Script","Gloria Hallelujah","Satisfy","Lobster Two","Comfortaa","Cinzel","Courgette"];
var string = "";
var select = document.getElementById("select")
for(var a = 0; a < fonts.length ; a++){
	var opt = document.createElement('option');
	opt.value = opt.innerHTML = fonts[a];
	opt.style.fontFamily = fonts[a];
	select.add(opt);
}
function fontChange(){
	var x = document.getElementById("select").selectedIndex;
    var y = document.getElementById("select").options;
	document.body.insertAdjacentHTML("beforeend", "<style> #text{ font-family:'"+y[x].text+"';}"+
																	 "#select{font-family:'"+y[x].text+"';</style>");
                                                                     
	var t3 = new TimelineLite, 
	mySplitText3 = new SplitText("#h3", {type:"words,chars"}), 
	chars = mySplitText3.chars; //an array of all the divs that wrap each character
	TweenLite.set("#h3", {perspective:400});
	t3.staggerFrom(chars, 0.2, {opacity:0, scale:0, y:80, rotationX:180, transformOrigin:"0% 150% -50",  ease:Back.easeOut}, 0.01, "+=0");
    var pp = document.querySelector('my-pedal');
    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('test').style.fontFamily = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('font-family');
    }
}
/* TweenLite.to(page, 0, {top:"-100vh", ease:Bounce.easeOut, delay:0});
TweenLite.to(page, 1, {top:"0vh", ease:Elastic.easeOut, delay:1}); */
//fontChange();

function labelPedalChange(){

    var pp=document.querySelector('my-pedal');
    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('test').style.fontFamily = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('font-family');
    }
}

var totalClicksX= 0;

function moveLabelXLeft(){
    var pp=document.querySelector('my-pedal');
    //var t='10';
    //var click=0;
    //var link = document.getElementById('moveLabelXLeft');
    totalClicksX += 10;
    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('textB').style.right = String(totalClicksX).concat("px");
    }    
}


function moveLabelXRight(){
    var pp=document.querySelector('my-pedal');
    //var t='10';
    //var click=0;
    //var link = document.getElementById('moveLabelXRight');
    totalClicksX -= 10;
    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('textB').style.right = String(totalClicksX).concat("px");
    }  
}

var totalClicksY = 0;

function moveLabelYUp(){
    var pp=document.querySelector('my-pedal');
    //var t='10';
    //var click=0;
    //var link = document.getElementById('moveLabelXRight');
    totalClicksY += 10;
    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('textB').style.bottom = String(totalClicksY).concat("px");
    }  
}

function moveLabelYDown(){
    var pp=document.querySelector('my-pedal');
    //var t='10';
    //var click=0;
    //var link = document.getElementById('moveLabelXRight');
    totalClicksY -= 10;
    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('textB').style.bottom = String(totalClicksY).concat("px");
    }  
}


function changeSize(n) {
    var s = document.getElementById('h3');
    var pp=document.querySelector('my-pedal');
    s.style.fontSize = n.value + 'px'

    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('test').style.fontSize = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('font-size');
    }
}


function fontSizeX(){
    var s = document.getElementById('h3');
    var pp = document.querySelector('my-pedal');
    //var click = Number(window.getComputedStyle(document.getElementById('h3')).getPropertyValue('font-size').slice(0,2));
    
    //var click = Number(document.getElementById('sel1').value);
    var sel = document.getElementById('sel1');

    var link = document.getElementById('fontSizeX');
    link.onclick = function(){
        
        if(pp.shadowRoot){
            var toto = Number(window.getComputedStyle(pedal.shadowRoot.getElementById('test')).getPropertyValue('font-size').slice(0,2));
        }
        click = toto + 1;

        if(pp.shadowRoot){
            pedal.shadowRoot.getElementById('test').style.fontSize = String(click).concat("px");
        }
        //s.style.fontSize = click + 'px';
        //document.getElementById('sel1').value = click;
    };
    
}


function fontSizeY(){
    var s = document.getElementById('h3');
    var pp = document.querySelector('my-pedal');
    //var click = Number(window.getComputedStyle(document.getElementById('h3')).getPropertyValue('font-size').slice(0,2));
    
    //var click = Number(document.getElementById('sel1').value);
    var sel = document.getElementById('sel1');

    var link = document.getElementById('fontSizeY');
    link.onclick = function(){
        
        if(pp.shadowRoot){
            var toto = Number(window.getComputedStyle(pedal.shadowRoot.getElementById('test')).getPropertyValue('font-size').slice(0,2));
        }
        if(toto > 0){
            click = toto - 1;
        }
        

        if(pp.shadowRoot){
            pedal.shadowRoot.getElementById('test').style.fontSize = String(click).concat("px");
        }
        //s.style.fontSize = click + 'px';
        //document.getElementById('sel1').value = click;
    };
    
}


function changeLabelFont(n){
    var s = document.getElementById('h3');
    var pp=document.querySelector('my-pedal');
    s.style.fontFamily = n.value;

    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('test').style.fontFamily = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('font-family');
    }
}

function changeColor(n){
    var s = document.getElementById('h3');
    var pp=document.querySelector('my-pedal');
    var ca = "#";

    s.style.color = ca.concat(n.value);

    if(pp.shadowRoot){
        pedal.shadowRoot.getElementById('test').style.color = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('color');
    }
}


function pedalitemslist(){
    var length = pedal.shadowRoot.getElementById('pedal').children.length;
    //var i=2;
    var sel = document.getElementById('selectliste');
    
    

    for(var i = 2; i<=length-1; i++){
        var opt = document.createElement('option');
        opt.text = pedal.shadowRoot.getElementById('pedal').children[i].id;
        sel.appendChild(opt);
    }
    
}


$('a[href$="#myModal"]').on( "click", function() {
   $('#myModal').modal('show');
});


$('a[href$="#myModal2"]').on( "click", function() {
   $('#myModal2').modal('show');
});

$('a[href$="#myModal3"]').on( "click", function() {
   $('#myModal3').modal('show');
});

$('a[href$="#myModal4"]').on( "click", function() {
   $('#myModal4').modal('show');
});

$('a[href$="#myModal5"]').on( "click", function() {
   $('#myModal5').modal('show');
});



/* $(".dropdown-toggle").on("mouseenter", function () {
    // make sure it is not shown:
    if (!$(this).parent().hasClass("show")) {
        $(this).click();
    }
});


$(".btn-group, .dropdown").on("mouseleave", function () {
    // make sure it is shown:
    if ($(this).hasClass("show")){
        $(this).children('.dropdown-toggle').first().click();
    }
}); */


$(function(){
            $("#menu-toggle").click(function(e) {
                e.preventDefault();
                $("#wrapper").toggleClass("toggled");
            });

            $(window).resize(function(e) {
              if($(window).width()<=768){
                $("#wrapper").removeClass("toggled");
              }else{
                $("#wrapper").addClass("toggled");
              }
            });
          });


function toggleFullScreen() {
  if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen(); 
    }
  }
}


function closeMenu(){
   var mn = document.getElementById("closeLink");
    mn.onclick =  function() {
        toggleMenu("hide");
    };
}

function RGBAToHexA(r,g,b,a) {
  r = r.toString(16);
  g = g.toString(16);
  b = b.toString(16);
  a = Math.round(a * 255).toString(16);

  if (r.length == 1)
    r = "0" + r;
  if (g.length == 1)
    g = "0" + g;
  if (b.length == 1)
    b = "0" + b;
  if (a.length == 1)
    a = "0" + a;

  return "#" + r + g + b + a;
}

var nbliensclick = 0;

function BoldStyle(){
    var click = 0;
    var link = document.getElementById('boldid');
    var pp=document.querySelector('my-pedal');
    document.getElementById("h3").style.fontWeight = "900";
    link.onclick = function(){
        click++;
        nbliensclick++;
        if((click % 2) == 0){
            document.getElementById("h3").style.fontWeight = "";
        }
        else{
            document.getElementById("h3").style.fontWeight = "900";
        }

        if(pp.shadowRoot){
            pedal.shadowRoot.getElementById('test').style.fontWeight = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('font-weight');
        }
    };
}

function UnderlineStyle(){
    var click = 0;
    var link = document.getElementById('underlineid');
    var pp=document.querySelector('my-pedal');
    document.getElementById("h3").style.textDecoration = "underline";
    link.onclick = function(){
        click++;
        nbliensclick++;
        if((click%2) == 0){
            document.getElementById("h3").style.textDecoration = "";
        }
        else{
            document.getElementById("h3").style.textDecoration = "underline";
        }
        if(pp.shadowRoot){
            pedal.shadowRoot.getElementById('test').style.textDecoration = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('text-decoration');
        }
    };
}

function OverlineStyle(){
    var click = 0;
    var link = document.getElementById('overlineid');
    var pp=document.querySelector('my-pedal');
    document.getElementById("h3").style.textDecoration = "overline";
    link.onclick = function(){
        click++;
        nbliensclick++;
        if((click%2) == 0){
            document.getElementById("h3").style.textDecoration = "";
        }
        else{
            document.getElementById("h3").style.textDecoration = "overline";
        }
        if(pp.shadowRoot){
            pedal.shadowRoot.getElementById('test').style.textDecoration = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('text-decoration');
        }
    };
}


function GripLinesStyle(){
    var click = 0;
    var link = document.getElementById('griplinesid');
    var pp=document.querySelector('my-pedal');
    document.getElementById("h3").style.textDecoration = "underline overline";
    link.onclick = function(){
        click++;
        nbliensclick++;
        if((click%2) == 0){
            document.getElementById("h3").style.textDecoration = "";
        }
        else{
            document.getElementById("h3").style.textDecoration = "underline overline";
        }
        if(pp.shadowRoot){
            pedal.shadowRoot.getElementById('test').style.textDecoration = window.getComputedStyle(document.getElementById('h3')).getPropertyValue('text-decoration');
        }
    };
}



function LoadTemplateConfig(){
    var frame = document.getElementById('template1');
    var linkframe = document.getElementById('selectTemplate');

    
    
}


function LabelColorStyle(){
    
}


function refreshModal(){
    
    document.getElementById('width').value = '';
    document.getElementById('color').value = '';
    document.getElementById('height').value = '';
    document.getElementById('radius').value = '';
    document.getElementById('name').value = '';
}

    var url = "http://localhost:8085";
    let serverUrl = 'http://localhost:3000';

    var http = new XMLHttpRequest();
    var path = "/pedale";
    //var ctx = new AudioContext();
    var section = document.getElementsByClassName("pedalSection")[0];
    //var section2 = document.getElementById('editor-pedal-details');
    var pedal = getFirstChild(section);
    var editorPedalDetails = document.getElementById('editor-pedal-details');
    var knobSprite;
    var switchSprite;
    let savedPedalsConfigs;
    let functionalPedalGenerator;

    var bt_buildIt = document.querySelector('#bt_buildIt');
    let currentWapName, currentWapCode;


    window.onload = initialize;
    //Mettre en commentaire la fonction ci-dessous avant d'utiliser faust, bug  rgler
    /* function init(){
        var pp = document.querySelector('my-pedal');
        if(pp.shadowRoot){
            divs = pedal.shadowRoot.querySelectorAll('.draggable');
            divs.forEach(e => {
            e.onmousedown = function (evt) {
                dragInit(evt);
                //console.log('true');
                e.stopPropagation();
            };
                      })
        }
    } */

    function initialize() {
        
        var urlParams = new URLSearchParams(window.location.search);

        console.log(urlParams.has('data')); // true
        console.log(urlParams.get('data'));
        console.log("name present : " + urlParams.has('name')); // true
        console.log("name = " + urlParams.get('name'));
        console.log("### FAUSTUI JSON = ");
        console.log(urlParams.get('data'));
        console.log("###");
        faustUI = JSON.parse(urlParams.get('data'));
        let name = urlParams.get('name');
        /* ####### Commenter la ligne de faustUI.WapName ci-dessous quand on n'utilise pas faust editor ######## */
        //faustUI.WapName = name.substr(0, name.lastIndexOf("."));
        //document.querySelector("#wapName").innerHTML = faustUI.WapName;
        //Mettre en commentaire init() quand on utilise faust editor, bug  rgler
        //init();
        console.log("Initialize")
        console.log("faustUI = ", faustUI)
        //setFaustUIFromUrl();
        //console.log("faustUi aprs setFaustUIFromUrl= ", faustUI)


        //displaySavedPedalsIds();

        /* bt_buildIt.addEventListener('click', () => {

            checkMetadata(document.querySelector("#urlPlugin").value);
        }); */

        let faust = document.querySelector('#editor-faust'),
            faustClone = faust.cloneNode(true);
        faust.parentNode.replaceChild(faustClone, faust);

        faust = document.querySelector('#editor-faust');
        /*faust.addEventListener('create-pedal', (e) => {
            newPedal();
            let pedalConfig = {
                name: "First",
                color: "#7caeff",
                width: e.detail.width,
                height: e.detail.height,
                radius: "10",
                opacity: "1",
                elements: e.detail.elements
            };
            //console.log(e.detail);
            pedal.loadConfig(pedalConfig);
        });*/
        if (window.faustUI) {
            console.log("### faustUI present ! ####")
            console.log(window.faustUI);
            newPedal(null, true);

            let detail = faust.pedalConfigFromUI(window.faustUI);

            let pedalConfig = {
                name: window.faustUI.WapName,
                color: "#7caeff",
                width: detail.width,
                height: detail.height,
                radius: "10",
                opacity: "1",
                elements: detail.elements
            };
            console.log(detail);
            console.log("PEDALCONFIG = ", pedalConfig);

            pedal.loadConfig(pedalConfig);
            currentWapName = pedalConfig.name;

        }
    }

    function setFaustUIFromUrl() {
        let url = new URL(location);
        let searchParams = new URLSearchParams(url.search);
        console.log("url = ", url)
        faustUI = searchParams.get('data');
        console.log("data = ", faustUI)
    }


    /*Slider Nav Menu*/
    function openNav() {
        document.getElementById("mySidenav").style.width = "500px";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
    }

    function newPedal(args, withoutInit) {



        section.innerHTML = '';
        pedal = null;
        let pedalElem = document.createElement('my-pedal');
        pedalElem.id = "my-pedal";
        //pedalElem.className = "draggable";
        section.appendChild(pedalElem);
        pedal = pedalElem;
        

        pedal.addEventListener('select-knob', function (e) {
            selectKnob(e.detail);
            updateInspector();
        });

        if (!withoutInit) {
            initialize();
        }

        var r = Number(document.getElementById("color").value.slice(5,8));
        var g = Number(document.getElementById("color").value.slice(9,12));
        var b = Number(document.getElementById("color").value.slice(13,16));
        var a = Number(document.getElementById("color").value.slice(17,20));
        //RGBAToHexA(r,g,b,a)

        let defaultPedalConfig = {
            color: document.getElementById('color').value,
            width: Number(document.getElementById('width').value),
            height: Number(document.getElementById('height').value),
            radius: Number(document.getElementById('radius').value),
            elements: [],
            name: document.getElementById('name').value
        };

        
        let modifiedPedalConfig = {
            color : RGBAToHexA(r,g,b,a),
            width : window.getComputedStyle(pedal.shadowRoot.getElementById('pedal')).getPropertyValue('width').slice(0,window.getComputedStyle(pedal.shadowRoot.getElementById('pedal')).getPropertyValue('width').lastIndexOf("p")),
            height : window.getComputedStyle(pedal.shadowRoot.getElementById('pedal')).getPropertyValue('height').slice(0,window.getComputedStyle(pedal.shadowRoot.getElementById('pedal')).getPropertyValue('width').lastIndexOf("p")),
            radius : window.getComputedStyle(pedal.shadowRoot.getElementById('pedal')).getPropertyValue('radius').slice(0,window.getComputedStyle(pedal.shadowRoot.getElementById('pedal')).getPropertyValue('width').lastIndexOf("p")),
            elements:[],
            name: document.getElementById('name').value
        }

        if (args) {
            defaultPedalConfig.name = args.name;
            defaultPedalConfig.height = args.height;
            defaultPedalConfig.width = args.width;
            defaultPedalConfig.name = args.name;
            defaultPedalConfig.elements = args.elements;
        }

        pedal.loadConfig(defaultPedalConfig);
        //pedal.loadConfig(modifiedPedalConfig);
        /* if(Number(defaultPedalConfig.width) < Number(window.getComputedStyle(pedal.shadowRoot.getElementById('pedal')).getPropertyValue('width').slice(0,1))  || Number(defaultPedalConfig.width) > Number(window.getComputedStyle(pedal.shadowRoot.getElementById('pedal')).getPropertyValue('width').slice(0,1))) {
            
            pedal.loadConfig(modifiedPedalConfig);
        }
        else{
            pedal.loadConfig(defaultPedalConfig);
        } */
        plugPedalToEditor();



        functionalPedalGenerator = new FunctionalPedalGenerator(pedal);;

        document.getElementById('h3').innerHTML = document.getElementById('label').value;
        var ped = document.querySelector('my-pedal');

        if (ped.shadowRoot) {
            pedal.shadowRoot.getElementById('test').innerHTML = document.getElementById('label').value;
            /* window.addEventListener("click", e => {
                const flyoutElement = document.getElementById("closeLink");
                let targetElement = e.target;
                if (targetElement === flyoutElement) toggleMenu("hide");
            }); */

            /* window.addEventListener("contextmenu", e => {
                e.preventDefault();
                const origin = {
                    left: e.pageX,
                    top: e.pageY
                };
                setPosition(origin);
                return false;
            }); */
        }
    }

    function removeDOMElement(){
        var p = document.querySelector('my-pedal');

        if(p.shadowRoot){
            //pedal.shadowRoot.getElementById('pedal').removeChild(pedal.shadowRoot.getElementById('pedal').children[2]);

            for(var i=2; i<pedal.shadowRoot.getElementById('pedal').childElementCount; i++){
                pedal.shadowRoot.getElementById('pedal').removeChild(pedal.shadowRoot.getElementById('pedal').children[i]);
            }
        }
        
    }


    /* function removeDOMElement(){
        var p = pedal.shadowRoot.getElementById('pedal');

        p.addEventListener("click",function(e) {
        var tgt = e.target;
        if (tgt.id.includes('knob')) {
            tgt.parentNode.removeChild(tgt); // or tgt.remove();
        }
        });
    } */

    function savePedal() {

        let pedalName = pedal.getAttribute('name');
        if (pedalName == '') {
            alert('You should enter the pedal name before saving !');
            return;
        }

        let config = pedal.getConfig();

        let http = new XMLHttpRequest();
        let url = serverUrl + '/pedals';
        let params = config;
        http.open("POST", url, true);

        http.setRequestHeader("Content-type", "application/json");

        http.onreadystatechange = function () {
            if (http.readyState == 4 && http.status == 200) {
                alert('Saved successfully!');
                pedal.pedalId = JSON.parse(http.responseText).id;
                //displaySavedPedalsIds();
            }
        }
        http.send(JSON.stringify(params));
        generateCodeFunctionalPedalFetch();
    }

    function refreshSavedPedalsConfigs() {
        let request = new XMLHttpRequest();
        request.open('GET', serverUrl + '/pedals', false);
        request.send(null);
        let pedalConfigs = JSON.parse(request.responseText);
        savedPedalsConfigs = pedalConfigs;
    }

    /* function displaySavedPedalsIds() {

        // Uptates the list of pedal configurations by fetching then from the server. 
        refreshSavedPedalsConfigs();

        // Gets the select element that displays the list of names of the saved pedal configurations. 
        let loadPedalElem = document.querySelector('#load-pedal');

        let oldVal = loadPedalElem.value;

        // Flushes the select element to get rid of the old pedal configurations that have been generated
        //during the last call to this function. If we don't flush it, the names of the new pedal configurations
        //will be appended to the ones that has been fetched in the previous call to the function.
        loadPedalElem.innerHTML = '';

        for (let savedPedalConfig of savedPedalsConfigs) {
            let savedPedalIdElem = document.createElement('option');
            savedPedalIdElem.setAttribute('value', savedPedalConfig.id);
            savedPedalIdElem.innerHTML = savedPedalConfig.name;

            loadPedalElem.appendChild(savedPedalIdElem);
        }

        loadPedalElem.value = oldVal;

    } */


    function setSelectedElementLabel(value) {
        let element = pedal.getSelectedElement();
        element.label = value;
        pedal.updateStyle_();
    }

    function setSelectedElementLabelColor(value) {
        let element = pedal.getSelectedElement();
        element.label_color = value;
        pedal.updateStyle_();
    }

    function setSelectedElementLabelFontfamily(value) {
        let element = pedal.getSelectedElement();
        element.label_fontfamily = value;
        pedal.updateStyle_();
    }

    function setSelectedElementLabelFontsize(value) {
        let element = pedal.getSelectedElement();
        element.label_fontsize = value;
        pedal.updateStyle_();
    }

    function setSelectedElementValue(value) {
        let element = pedal.getSelectedElement();
        element.value = value;
        pedal.updateStyle_();
    }

    function setSelectedElementModel(value) {
        let element = pedal.getSelectedElement();
        element.model = value;
        pedal.updateStyle_();
        selectKnob(pedal.getSelectedElement());
    }

    function setSelectedElementXPosition(xPosition) {
        let element = pedal.getSelectedElement();
        element.x = xPosition;
        pedal.updateStyle_();
    }

    function setSelectedElementYPosition(yPosition) {
        let element = pedal.getSelectedElement();
        element.y = yPosition;
        pedal.updateStyle_();
    }

    function setSelectedElementWidth(width) {
        let keepRatio = document.querySelector("#keep-ratio").checked;


        let element = pedal.getSelectedElement();
        element.width = width;

        if (keepRatio) {
            element.height = element.width;
            document.querySelector("#inspector-height").value = width;
        }

        pedal.updateStyle_();
    }

    function setSelectedElementHeight(height) {
        let keepRatio = document.querySelector("#keep-ratio").checked;

        let element = pedal.getSelectedElement();
        element.height = height;

        if (keepRatio) {
            element.width = element.height;
            document.querySelector("#inspector-width").value = height;

        }

        pedal.updateStyle_();
    }

    /*function updatePedalElementsSection() {

        // Deleting the elements of all the sections.
        for (let pedalElementType of pedal.getElementsTypes()) {
            let section = getSectionByPedalElementType(pedalElementType);

            if (!section) {
                continue;
            }

            let firstChild;
            while (firstChild = section.firstChild) {
                section.removeChild(firstChild);
            }
        }


        // Populating the sections.
        for (let pedalElement of pedal.getElements()) {
            let section = getSectionByPedalElementType(pedalElement.type);
            if (!section) {
                continue;
            }

            let idElem = document.createElement('div');
            idElem.className = pedalElement.type + '_id';
            idElem.innerHTML = pedalElement.id;
            idElem.onclick = (e) => {
                selectKnob(e.target.innerHTML);
            }

            section.appendChild(idElem);
        }

        // Select the pedal's selected element.
        let selectedElement = pedal.getSelectedElement();
        if (selectedElement) {
            selectKnob(selectedElement.id);
        }

    }*/

    function getSectionByPedalElementType(pedalElementType) {
        let section = document.querySelector('#' + pedalElementType + '_section');

        return section;
    }

    function updateInspector() {
        pedal.getSelectedElement();
    }

    function selectKnob(knobId) {

        /*
        var knobs = document.getElementById('knob_section').childNodes;
        var icons = document.getElementById('icon_section').childNodes;

        for (let knob of knobs) {
            // TODO: Remove.
            if (knob.className)
                knob.className = knob.className.replace('selected', '');
            if (knob.innerHTML === knobId) {
                knob.className += ' selected';
            }
        }

        for (let icon of icons) {
            // TODO: Remove.
            if (icon.className)
                icon.className = icon.className.replace('selected', '');
            if (icon.innerHTML === knobId) {
                icon.className += ' selected';
            }
        }

        if (pedal.getSelectedElement().id != knobId) {
            pedal.selectElement(knobId);
        }*/


        let knob = pedal.getSelectedElement();
        let inspectorId = document.getElementById('inspector-id');
        let inspectorLabel = document.getElementById('inspector-label');
        let inspectorLabelColor = document.getElementById('inspector-label-color');
        let inspectorLabelFontFamily = document.getElementById('inspector-label-font-family');
        let inspectorLabelSize = document.getElementById('inspector-label-font-size');
        let inspectorXPosition = document.getElementById('inspector-x-position');
        let inspectorYPosition = document.getElementById('inspector-y-position');
        let inspectorWidth = document.getElementById('inspector-width');
        let inspectorHeight = document.getElementById('inspector-height');

        let inspectorModel = document.getElementById('inspector-model');
        let inspectorPreview = document.getElementById('inspector-preview');



        inspectorLabel.value = knob.label;
        inspectorLabelColor.value = knob.label_color;
        inspectorLabelFontFamily.value = knob.label_fontfamily;
        inspectorLabelSize.value = knob.label_fontsize;
        inspectorXPosition.value = knob.x;
        inspectorYPosition.value = knob.y;
        inspectorWidth.value = knob.width || 0;
        inspectorHeight.value = knob.height || 0;

        inspectorModel.value = knob.model;

        let inspector = document.getElementById('inspector');
    }

    function deleteSelectedElement() {
        pedal.deleteSelectedElement();
        updatePedalElementsSection();
    }

    function addSlider() {
        pedal.addElement('slider');
    }



    function loadPedalConfig(value) {

        newPedal();
        for (let pedalConfig of savedPedalsConfigs) {
            if (pedalConfig.id == value) {
                pedal.loadConfig(pedalConfig);

                let loadPedal = document.querySelector('#load-pedal');
                loadPedal.value = value;
            }
        }

        plugPedalToEditor();
    }

    function plugPedalToEditor() {

        // Plug pedal to pedal details component
        let pedalDetails = document.querySelector('#editor-pedal-details');
        let newPedalDetails = pedalDetails.cloneNode();
        pedalDetails.parentNode.replaceChild(newPedalDetails, pedalDetails);
        newPedalDetails.setEditablePedal(pedal);

        // Plug pedal to element list component
        let elementList = document.querySelector('#editor-element-list');
        elementList.setEditablePedal(pedal);

        // Plug pedal to inspector component
        let inspector = document.querySelector('#editor-inspector');
        inspector.setEditablePedal(pedal);
    }

    function getFirstChild(el) {
        var firstChild = el.firstChild;

        while (firstChild != null && firstChild.nodeType == 3) { // skip TextNodes
            firstChild = firstChild.nextSibling;
        }

        return firstChild;
    }

    // Sends the main.html GUI file for the wap named currentWapName
    // to the backend server. A dir is created if there is none already
    // created for this WAP.
    // It also copies asset files if necessary, and finally sends a message to the Faust IDE
    // to ask for it to generate a binary.zip file with the DSP code. An async message will be 
    // sent back by the faust IDE when ready (processed in the next listener defined after this
    // function)
    function generateCodeFunctionalPedalFetch() {
        let url = serverUrl + '/generate';

        let data = new FormData();
        data.append("generated", functionalPedalGenerator.generateFunctionalPedalCode());
        data.append("wapName", currentWapName);
        data.append("wapCode", currentWapCode);

        fetch(url, {
                method: "POST",
                body: data
            })
            .then((responseJSON) => {
                responseJSON.json()
                    .then(res => {
                        console.log(res.message);
                        alert(res.message);
                    })
            })
            .catch(err => {
                console.log(err)
            })

        // 1 - SEND ASYNC MESSAGE TO FAUST EDITOR
        console.log("SENDING EXPORT MESSAGE TO FAUST EDITOR")
        if (window.parent !== window) {
            window.parent.postMessage({
                type: "export",
                plat: "web",
                arch: "wap"
            })
        }

    }

    // 2 - SENT BY FAUST IDE WHEN THE BINARY.ZIP FILE IS READY TO BE SENT TO BACK-END WAP SERVER
    window.addEventListener("message", (e) => {
        const data = e.data;

        if (data.type === "build") {
            console.log("CODE for name = " + currentWapName + "= " + data.code);
            currentWapCode = data.code;
        }

        if (data.type === "exported") {
            let wapBinaryDotZipFileURL = data.href
            console.log(wapBinaryDotZipFileURL);

            // Let's send a message to the backend server so that it gets
            // this file, and unzip it in the same dir the main.html GUI file + assets
            // have been created
            let url = serverUrl + '/addBinaryDotZip';
            let data2 = new FormData();
            data2.append("url", wapBinaryDotZipFileURL);
            data2.append("wapName", currentWapName);

            fetch(url, {
                    method: "POST",
                    body: data2
                })
                .then((responseJSON) => {
                    responseJSON.json()
                        .then(res => {
                            console.log(res.message);
                            alert(res.message);
                        })
                })
                .catch(err => {
                    console.log(err)
                })
        }
    });


    // Sends the binary.zip to the Back-End
    function publish(downPath, pedalName) {
        var http = new XMLHttpRequest();
        var url = 'http://localhost:3000/generated-wap';
        var params = {
            url: downPath,
            pedalName: "current"
        };

        http.open('POST', url, true);

        //Send the proper header information along with the request
        http.setRequestHeader('Content-type', "application/json");

        http.onreadystatechange = function () { //Call a function when the state changes.
            if (http.readyState == 4 && http.status == 200) {
                alert(http.responseText);
            }
        }

        http.send(JSON.stringify(params));
    }

    function toggleHidden(elem) {
        if (elem.style.display === 'none') {
            elem.style.display = 'block';
        } else {
            elem.style.display = 'none';
        }
    }

    function toggleEditorPedalDetails() {
        let elem = document.querySelector('#editor-pedal-details');
        toggleHidden(elem);
    }



    // And of the forked content
    // -----------------------------Json fetching part ---------------------------//

    function checkMetadata(baseURL) {
        fetch(baseURL + "/main.json").then(responseJSON => {
            return responseJSON.json();
        }).then(metadata => {
            let name = metadata.name
            let className = metadata.vendor + metadata.name;
            loadPlugin(className, name, baseURL);
        }).catch((e) => {
            console.log(e);
        });
    }

    // add the script tag and load the plugin 
    function loadPlugin(className, name, baseURL) {
        let scriptURL = baseURL + "/main.js";

        // if we are here this means that the script is not present. Add it to the document
        let script = document.createElement("script");
        script.src = scriptURL;

        script.onload = function () {
            // Once the script has been loaded instanciate the plugin
            getDescriptorFromPlugin(className, name, baseURL);
        }
        // will be executed before the onload above...
        document.head.appendChild(script);
    }

    // instanciate the plugin 
    /* function getDescriptorFromPlugin(className, name, baseURL) {

         var plugin = new window[className](ctx, baseURL);
         console.log(plugin);

         plugin.load().then((node) => {
             plugin.loadGui().then((elem) => {
                 let descriptor = node.getDescriptor();
                 let dimensions = elem.properties;
                 let nbParam = Object.keys(descriptor).length;
                 var count = 0;
                 let hoffset = 50;
                 let voffset = 60;
                 console.log(descriptor);

                 //--------------------------------- JSON edition PART -------------------------//
                 let extendedDescriptor = {
                     "name": name,
                     "backgroundImageSrc": "image2.png",
                     "color": "#AB2E24",
                     "width": dimensions.dataWidth.value,
                     "height": dimensions.dataHeight.value,
                     "radius": "10",
                     "elements": []
                 }


                 for (var param in descriptor) {
                     // 2* because we want by default two ranges of knobs
                     let horizontalRange = Math.ceil(count % (nbParam / 2));
                     let verticalRange = Math.floor(count / (nbParam / 2));
                     console.log(param, horizontalRange, verticalRange);

                     // Here we do a little normalisation because we have to select by ID later

                     if (descriptor.hasOwnProperty(param)) {
                         var element = {
                             "id": param.toLowerCase().replace(/ /g, "").replace('\/', ""),
                             "x": hoffset * horizontalRange,
                             "y": voffset * verticalRange,
                             "width": 40,
                             "height": 40,
                             "model": "Carbon.png",
                             "value": descriptor[param].defaultValue,
                             "min": descriptor[param].minValue,
                             "max": descriptor[param].maxValue,
                             "label": param,
                             "label_fontfamily": "Verdana",
                             "label_fontsize": "7",
                             "label_color": "000000",
                             "type": "knob"
                         }

                     }
                     count++;
                     extendedDescriptor.elements.push(element);


                 }
                 var elemlabel = {
                     "x": 20,
                     "y": 130,
                     "label": name,
                     "label_fontfamily": 'Comic Sans MS',
                     "label_fontsize": '14',
                     "label_color": 'ffffff',
                     "type": 'label'
                 }
                 extendedDescriptor.elements.push(elemlabel);
                 //-------------------- END of JSON Edition -------------------- //

                 newPedal(extendedDescriptor);
                 console.log(extendedDescriptor);


             });
             delete node;

         });

         delete plugin;

     }*/
</script>

</html>